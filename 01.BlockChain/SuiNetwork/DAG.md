
DAG(Directed Acyclic Graph, 방향성 비순환 그래프)는 블록체인 기술에서 전통적인 선형 체인 구조의 한계를 극복하기 위해 도입된 혁신적인 데이터 구조입니다.

## DAG의 기본 개념

**방향성(Directed)**: 그래프의 모든 엣지(연결선)가 특정 방향을 가지고 있어, 한 노드에서 다른 노드로의 단방향 연결을 의미합니다. 블록체인에서는 이전 블록이나 트랜잭션을 참조하는 방향성을 나타냅니다.

**비순환(Acyclic)**: 그래프 내에서 시작점으로 돌아오는 순환 경로가 존재하지 않습니다. 이는 시간적 인과관계를 보장하며, 이전 상태로 되돌아가는 것을 방지합니다.

**그래프(Graph)**: 노드(정점)와 엣지(간선)로 구성된 수학적 구조로, 블록체인에서 노드는 블록이나 트랜잭션을, 엣지는 참조 관계를 나타냅니다.

## 전통적 블록체인 vs DAG 구조

**선형 체인의 한계**: 비트코인이나 이더리움 같은 전통적 블록체인은 블록들이 하나의 체인으로 연결된 선형 구조를 가집니다. 이는 한 번에 하나의 블록만 생성할 수 있어 처리량이 제한됩니다.

**DAG의 병렬성**: DAG 구조에서는 여러 블록이나 트랜잭션이 동시에 생성되고 참조될 수 있어, 네트워크 처리량을 크게 향상시킵니다.

## DAG 기반 합의 메커니즘

### 블록 제안과 참조 시스템

**다중 제안자**: 여러 검증자가 동시에 블록을 제안할 수 있어 네트워크 대역폭을 완전히 활용하고 검열 저항성을 제공합니다.

**참조 기반 투표**: 새로운 블록이 이전 블록들을 참조함으로써 암시적으로 해당 블록들에 "투표"하는 효과를 냅니다. 이는 명시적인 투표 과정을 생략하여 통신 오버헤드를 줄입니다.

### 라운드 기반 진행

```
라운드 1: [블록 A] [블록 B] [블록 C]
           |         |         |
라운드 2: [블록 D] ←--+         |
           |                   |
           ↓                   |
라운드 3: [블록 E] ←------------+
```

각 라운드에서 검증자들은 메시지(블록)를 브로드캐스트하고, 이전 라운드의 메시지들을 참조합니다.

## DAG에서의 합의 달성

### 암시적 커밋 메커니즘

**참조 기반 확인**: 블록이 충분한 수의 후속 블록들에 의해 참조되면 자동으로 커밋됩니다. 이는 명시적인 검증이나 투표 없이도 합의를 달성할 수 있게 합니다.

**강한 다수 원칙**: 특정 블록이 검증자들의 강한 다수(보통 2/3 이상)에 의해 직간접적으로 참조되면 최종 확정됩니다.

### 순서 결정 알고리즘

**위상 정렬**: DAG의 구조를 분석하여 트랜잭션들의 실행 순서를 결정합니다. 종속성이 있는 트랜잭션들은 올바른 순서로 실행되고, 독립적인 트랜잭션들은 병렬로 처리됩니다.

**리더 기반 순서화**: 특정 라운드의 "리더" 블록을 기준으로 해당 서브-DAG의 모든 트랜잭션 순서를 결정하는 방식도 사용됩니다.

## DAG의 기술적 장점

### 확장성 향상

**병렬 처리**: 여러 트랜잭션이 동시에 처리될 수 있어 네트워크 처리량이 검증자 수에 비례하여 증가합니다.

**대역폭 최적화**: 모든 검증자가 동시에 블록을 제안할 수 있어 네트워크 대역폭을 최대한 활용합니다.

### 지연시간 감소

**즉시 제안**: 이전 블록의 완성을 기다릴 필요 없이 즉시 새로운 블록을 제안할 수 있습니다.

**단축된 확인 시간**: 명시적 투표 과정이 생략되어 합의 도달 시간이 단축됩니다.

## 실제 구현 예시

### Sui의 Mysticeti DAG

**메시지 구조**: 각 메시지는 트랜잭션 세트와 이전 메시지들에 대한 참조를 포함합니다.

**로컬 해석**: 각 검증자는 자신의 로컬 DAG 뷰를 기반으로 추가 메시지 교환 없이 트랜잭션 순서를 결정합니다.

### Narwhal과 Bullshark

**Narwhal**: 트랜잭션의 가용성을 보장하는 DAG 구조를 생성합니다.

**Bullshark**: DAG를 해석하여 트랜잭션의 순서를 결정하는 알고리즘입니다.

## DAG의 도전과제

### 복잡성 관리

**상태 추적**: 여러 분기가 존재하는 DAG에서 일관된 상태를 유지하는 것은 복잡합니다.

**충돌 해결**: 동일한 리소스에 대한 경합 트랜잭션들을 올바르게 순서화해야 합니다.

### 네트워크 분할 대응

**부분적 연결성**: 네트워크 분할 상황에서도 각 파티션이 진행할 수 있지만, 재연결 시 일관성을 보장해야 합니다.

**비동기 환경**: 메시지 지연이나 손실이 있는 환경에서도 안전성을 보장해야 합니다.

## 미래 발전 방향

### 동적 DAG

**적응형 구조**: 네트워크 상황에 따라 DAG 구조를 동적으로 조정하는 연구가 진행되고 있습니다.

**ML 최적화**: 머신러닝을 활용하여 최적의 참조 패턴을 학습하는 방법들이 연구되고 있습니다.

### 크로스체인 DAG

**인터체인 통신**: 여러 블록체인 간의 통신을 DAG 구조로 관리하는 방법들이 개발되고 있습니다.

**샤딩 통합**: 샤딩된 블록체인들 간의 조정을 DAG로 처리하는 접근법들이 제안되고 있습니다.

DAG는 블록체인의 확장성과 성능 문제를 해결하는 핵심 기술로, 특히 고성능이 요구되는 웹3 애플리케이션들에게 새로운 가능성을 열어주고 있습니다.